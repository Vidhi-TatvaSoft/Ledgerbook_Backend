@{
    ViewData["Title"] = "Login";
    Layout = "~/Views/Shared/_LoginLayout.cshtml";
}

<div id="login-signup-form-id"></div>

<div id="loginFormDivId" class="d-none">
    <h2><b>Login</b></h2>
    <form id="login-form-id" class="login-form">

        <div class="form-floating mb-4 position-relative">
            <input type="email" id="login-email" name="loginEmail" onkeyup="emailValidation(this)"
                onblur="emailValidation(this)" class="form-control border border-dark w-100 h-100"
                placeholder="Email*" />
            <i class="fa-solid fa-envelope position-absolute translate-middle-y fs-4 me-3 email-icon-class"></i>
            <label for="login-email" class="form-floating text-dark ">Email*</label>
            <span class="text-danger emailValidationMessage validationMessage"></span>
        </div>

        <div class="form-floating mb-4 position-relative">
            <input type="password" class="form-control border border-dark w-100 " id="login-password"
                onkeyup="passwordValidation(this)" onblur="passwordValidation(this)" name="login-password"
                placeholder="Password*" />
            <i class="fa-solid fa-eye-slash position-absolute translate-middle-y fs-4 me-3 password-icon-class"
                onclick="toggle_fnction('login-togglePassword','login-password')" id="login-togglePassword"></i>
            <label for="login-password" class="form-floating text-dark ">Password*</label>
            <span class="text-danger passwordValidationMessage validationMessage"></span>
        </div>

        <!-- Remember me and forgot pass section -->
        <div
            class="rememberme-div d-flex flex-md-row flex-column flex-wrap justify-content-md-between justify-content-start align-items-start ">
            <div class="form-check">
                <input class="form-check-input  border-dark" type="checkbox" id="login-rememberme">
                <label class="fs-5 ms-2 text-dark text-nowrap" for="rememberme">Remember Me</label>
            </div>
            <a id="forgot-password" onclick="flipToForgotPassword()"
                class="text-color fs-5 cursor-pointer text-decoration-none text-nowrap">Forgot
                Password?</a>
        </div>
        <div class="d-flex justify-content-start text-danger  fs-5 mb-2">@ViewData["LoginMessage"]</div>

        <div class="d-grid">
            <button class="login-btn btn btn-primary fs-5  pt-2 pb-2 w-100 " type="submit">Login</button>
            @* <input value="Login"  /> *@
        </div>
        <div class="d-flex justify-content-center mt-2 fs-5 text-dark text-nowrap flex-wrap">Don't have an Account?
            &nbsp;<a class="text-color cursor-pointer" onclick="flipToSignup()" style="text-decoration: none;">Sign
                Up</a>
        </div>
    </form>
</div>

<div id="registerFormDivId" class="d-none">
    <h2><b>Register</b></h2>
    <form id="registrationForm">

        <div class="form-floating mb-4 position-relative">
            <input type="text" id="register-FirstName" name="register-FirstName" onkeyup="nameValidation(this,'First')"
                onblur="nameValidation(this,'First')" class="form-control border border-dark w-100 h-100"
                placeholder="First Name*" />
            <i class="fa-solid fa-user position-absolute translate-middle-y fs-4 me-3 user-icon-class rounded"></i>
            <label for="register-FirstName" class="form-floating text-dark ">First Name*</label>
            <span class="FirstNameValidationMessage text-danger validationMessage"></span>
        </div>

        <div class="form-floating mb-4 position-relative">
            <input type="text" id="register-LastName" name="register-LastName" onkeyup="nameValidation(this,'Last')"
                onblur="nameValidation(this,'Last')" class="form-control border border-dark w-100 h-100"
                placeholder="Last Name*" />
            <i class="fa-solid fa-user position-absolute translate-middle-y fs-4 me-3 user-icon-class"></i>
            <label for="register-LastName" class="form-floating text-dark ">Last Name*</label>
            <span class="LastNameValidationMessage text-danger validationMessage"></span>
        </div>

        <div class="form-floating mb-4 position-relative">
            <input type="email" id="register-email" name="register-email" onkeyup="emailValidation(this)"
                onblur="emailValidation(this)" class="form-control border border-dark w-100 h-100"
                placeholder="Email*" />
            <i class="fa-solid fa-envelope position-absolute translate-middle-y fs-4 me-3 email-icon-class"></i>
            <label for="register-email" class="form-floating text-dark ">Email*</label>
            <span class="text-danger emailValidationMessage validationMessage"></span>
        </div>

        <div class="form-floating mb-4 position-relative">
            <input type="password" id="register-password" name="register-password" onkeyup="passwordValidation(this)"
                onblur="passwordValidation(this)" class="form-control border border-dark w-100 h-100"
                placeholder="Password*" />
            <i class="fa-solid fa-eye-slash position-absolute translate-middle-y fs-4 me-3 "
                onclick="toggle_fnction('register-togglePassword','register-password')" id="register-togglePassword"
                style="  top: 25px;right: -12px;background: white; padding: 11px; padding-top: 14px;"></i>
            <label for="register-password" class="form-floating text-dark  text-left">Password*</label>
            <span class="text-danger passwordValidationMessage validationMessage"></span>
        </div>

        <div class="form-floating mb-4 position-relative">
            <input type="password" id="register-confirmPassword" name="register-confirmPassword"
                onkeyup="cnfpasswordValidation(this,'register-password')"
                onblur="cnfpasswordValidation(this,'register-password')"
                class="form-control border border-dark w-100 h-100" placeholder="Confirm Password*" />
            <i class="fa-solid fa-eye-slash position-absolute translate-middle-y fs-4 me-3 password-icon-class"
                onclick="toggle_fnction('register-togglePassword1','register-confirmPassword')"
                id="register-togglePassword1"></i>
            <label for="register-confirmPassword" class="form-floating text-dark  text-left">Confirm Password*</label>
            <span class="text-danger cnfpasswordValidationMessage validationMessage"></span>
        </div>

        <div class="d-flex justify-content-start text-danger  fs-5 mb-2">@ViewData["RegisterMessage"]</div>

        <div class="d-grid">
            <input value="Sign Up" class="login-btn btn btn-primary fs-5  pt-2 pb-2 w-100" type="submit" />
        </div>
        <div class="d-flex justify-content-center mt-2 fs-5 text-dark text-nowrap flex-wrap">Already have an Account
            ? <a class="text-color cursor-pointer ms-3" onclick="flipToLogin()" style="text-decoration: none;">Login</a>
        </div>
    </form>
</div>

<div id="forgotPasswordFormDivId" class="d-none">
    <h2><b>Forgot Password</b></h2>
    <form id="forgotpassword-form-id" class="forgot-password-form">

        <div class="form-floating mb-4 position-relative">
            <input type="email" id="forgotpassword-email" name="forgotpassword-email"
                class="form-control border border-dark w-100 h-100" placeholder="Email*" />
            <i class="fa-solid fa-envelope position-absolute translate-middle-y fs-4 me-3 email-icon-class"></i>
            <label for="forgotpassword-email" class="form-floating text-dark ">Email*</label>
            <span class="validationMessage text-danger emailValidationMessage"></span>
        </div>

        <div class="d-grid">
            <input type="submit" value="Send Email" class="login-btn btn btn-primary fs-5  pt-2 pb-2 w-100 " />
            <a class="text-color cursor-pointer fs-5 ms-3 me-1 mt-2 d-flex justify-content-center"
                onclick="flipToLogin()" style="text-decoration: none;">Back to Login</a>
        </div>
    </form>
</div>

@section Scripts {
    <script type="module" src="~/js/constant.js"></script>
    <script src="~/js/Login/login.js"></script>

    <script>

        function loginWithCookie() {
            let params = setParameter("/Login/Login", GET, null, NODATA, null, LoginSuccess);
            ajaxCall(params);
        }

        function LoginFormSubmit() {
            let formData = new FormData();
            formData.append("Email", $("#login-email").val())
            formData.append("Password", $("#login-password").val())
            let params = setParameter("/Login/LoginAsync", POST, null, FORMDATA, formData, LoginSuccess);
            ajaxCall(params);
        }


        $(document).ready(function () {

            $(document).on("submit", "#login-form-id", function (e) {
                e.preventDefault();
                let isValidForm = validateLoginForm();
                if (isValidForm) {
                    LoginFormSubmit();
                }
            })


            $(document).on("submit", "#registrationForm", function (e) {
                e.preventDefault();
                let isValidForm = validateRegisterForm();
                if (isValidForm) {
                    let formData = new FormData();
                    formData.append("Email", $("#register-email").val())
                    formData.append("Password", $("#register-password").val())
                    formData.append("ConfirmPassword", $("#register-confirmPassword").val())
                    formData.append("FirstName", $("#register-FirstName").val())
                    formData.append("LastName", $("#register-LastName").val())
                    let params = setParameter("/Login/Register", POST, null, FORMDATA, formData, registerSuccess);
                    ajaxCall(params);

                }
            })

            $(document).on("submit", "#forgotpassword-form-id", function (e) {
                e.preventDefault();
                let isValidForm = validateForgotPasswordForm();
                if (isValidForm) {
                    let formData = new FormData();
                    formData.append("Email", $("#forgotpassword-email").val())
                    let email = $("#forgotpassword-email").val()
                    let params = setParameter("/Login/ForgotPassword", POST, null, FORM_URL, { email }, verifyEmailSuccess);
                    ajaxCall(params);
                }
            })

        });

        $(document).ready(function () {
            toasterFromLocalstorage();
            loginWithCookie();
        });


    </script>

    <partial name="_Toaster" />
}
